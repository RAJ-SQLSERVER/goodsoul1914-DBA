USE master 
GO

-- Run the cleanup script

-- Create the databases to use
CREATE DATABASE [DBMaint2012_1];
CREATE DATABASE [DBMaint2012_2];
CREATE DATABASE [DBMaint2012_3];
CREATE DATABASE [DBMaint2012_4];
CREATE DATABASE [DBMaint2012_5];
CREATE DATABASE [DBMaint2012_6];
CREATE DATABASE [DBMaint2012_7];
CREATE DATABASE [DBMaint2012_8];
CREATE DATABASE [DBMaint2012_9];
CREATE DATABASE [DBMaint2012_10];
CREATE DATABASE [DBMaint2012_11];
CREATE DATABASE [DBMaint2012_12];
CREATE DATABASE [DBMaint2012_13];
CREATE DATABASE [DBMaint2012_14];
CREATE DATABASE [DBMaint2012_15];
CREATE DATABASE [DBMaint2012_16];
CREATE DATABASE [DBMaint2012_17];
CREATE DATABASE [DBMaint2012_18];
CREATE DATABASE [DBMaint2012_19];
CREATE DATABASE [DBMaint2012_20];
CREATE DATABASE [DBMaint2012_21];
CREATE DATABASE [DBMaint2012_22];
CREATE DATABASE [DBMaint2012_23];
CREATE DATABASE [DBMaint2012_24];
CREATE DATABASE [DBMaint2012_25];
CREATE DATABASE [DBMaint2012_26];
CREATE DATABASE [DBMaint2012_27];
CREATE DATABASE [DBMaint2012_28];
CREATE DATABASE [DBMaint2012_29];
CREATE DATABASE [DBMaint2012_30];
CREATE DATABASE [DBMaint2012_31];
CREATE DATABASE [DBMaint2012_32];

-- Takes a few seconds

-- Create a table in the first database
USE [DBMaint2012_1];
GO

CREATE TABLE TestTable (c1 INT IDENTITY, c2 CHAR(1000) DEFAULT 'a');

-- Insert 7000 records in a transaction
SET NOCOUNT ON
GO

BEGIN TRANSACTION
GO

INSERT INTO dbo.TestTable (c2)
VALUES (DEFAULT)
GO 7000

-- In another query window, shutdown SQL Server
-- SHUTDOWN WITH NOWAIT

-- Then restart SQL Server

-- Make sure crash recovery has completed
EXEC sys.xp_readerrorlog
GO

-- Run the cleanup script again