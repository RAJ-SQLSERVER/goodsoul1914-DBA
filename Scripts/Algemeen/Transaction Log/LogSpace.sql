
/* --------------------------------------------------
 – To help find near-full logfiles that may 
   autogrow soon.
-------------------------------------------------- */


-------------------------------------------------------------------------------
-- Create table to hold raw data
-------------------------------------------------------------------------------
CREATE TABLE #temp
(
    DBName VARCHAR(100),
    SizeMB INT,
    UsedPct FLOAT,
    [STATUS] BIT
);

-------------------------------------------------------------------------------
-- Populate table
-------------------------------------------------------------------------------
INSERT #temp
EXEC ('DBCC SQLPERF(logspace)');

-------------------------------------------------------------------------------
-- Output
-------------------------------------------------------------------------------
SELECT DBName AS "database_name",
       SizeMB AS "logspace_size_mb",
       UsedPct AS "logspace_used_%"
FROM #temp; --WHERE UsedPct > 90 -- 90% full

-------------------------------------------------------------------------------
-- Clean-up
-------------------------------------------------------------------------------
DROP TABLE #temp;
GO
